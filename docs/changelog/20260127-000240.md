# 变更日志 - 2026-01-27 00:02:40

## 任务描述
实现视频下载功能

## 执行结果

### 新增功能

1. **下载执行器** (`src/main/services/downloader.ts`)
   - `startDownloadTask()` - 启动下载任务
   - `stopDownloadTask()` - 停止下载任务
   - `isTaskRunning()` - 检查任务是否运行中
   - 使用 `pLimit` 控制用户级并发
   - 通过 IPC 发送实时进度到渲染进程
   - 自动跳过已下载的作品（通过 aweme_id 检查）

2. **数据库** (`src/main/database/index.ts`)
   - 新增 `posts` 表存储已下载的作品
   - Post CRUD 函数: `createPost`, `getPostByAwemeId`, `getPostsByUserId`, `getPostCountByUserId`
   - `incrementDownloadedCount()` 更新用户已下载数量

3. **IPC 处理** (`src/main/index.ts`)
   - `download:start` - 启动下载
   - `download:stop` - 停止下载
   - `download:isRunning` - 检查状态
   - `download:progress` - 进度事件（推送到渲染进程）

4. **Preload API** (`src/preload/index.ts`)
   - `window.api.download.start(taskId)` - 启动下载
   - `window.api.download.stop(taskId)` - 停止下载
   - `window.api.download.isRunning(taskId)` - 检查状态
   - `window.api.download.onProgress(callback)` - 监听进度

5. **任务详情页** (`src/renderer/src/pages/settings/TaskDetailPage.tsx`)
   - 开始/停止下载按钮
   - 实时下载进度卡片
   - 显示当前用户、视频进度、已下载数量
   - Progress 进度条组件

6. **新组件** (`src/renderer/src/components/ui/progress.tsx`)
   - Progress 进度条组件

### 下载逻辑说明

- **存储路径**: `{userData}/Download/post/{sec_uid}/{create}_{caption}_{aweme_id}/`
- **并发控制**: 按任务配置的 `concurrency` 控制同时下载的用户数
- **下载内容**: 视频、封面、音乐、描述文件
- **去重**: 通过 `aweme_id` 检查是否已下载
- **进度推送**: 通过 `BrowserWindow.webContents.send()` 推送到所有窗口

### 依赖

- 新增 `p-limit` 用于并发控制

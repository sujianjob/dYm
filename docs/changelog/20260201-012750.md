# 任务级别定时同步功能

## 任务描述
实现下载任务级别的 cron 定时同步功能，允许用户为每个下载任务设置独立的定时执行计划。

## 完成的工作

### 1. 数据库层
- 在 `download_tasks` 表添加三个字段：
  - `auto_sync` (INTEGER): 是否开启自动同步
  - `sync_cron` (TEXT): cron 表达式
  - `last_sync_at` (INTEGER): 上次同步时间
- 更新 `DbTask` 接口包含新字段
- 更新 `CreateTaskInput` 和 `UpdateTaskInput` 接口
- 添加 `getAutoSyncTasks()` 和 `updateTaskLastSyncAt()` 函数

### 2. 调度器服务 (scheduler.ts)
- 新增任务级别调度支持：
  - `scheduleTask()`: 为任务创建 cron 调度
  - `unscheduleTask()`: 取消任务调度
  - `getScheduledTaskIds()`: 获取已调度的任务 ID 列表
- 更新 `initScheduler()` 同时初始化用户和任务调度
- 更新 `stopScheduler()` 同时停止用户和任务调度

### 3. IPC 通信
- 添加 `task:updateSchedule` IPC handler
- 更新 preload API 添加 `updateSchedule` 方法
- 更新类型定义

### 4. 前端 UI (DownloadPage.tsx)
- 添加定时同步开关 (Switch 组件)
- 添加 cron 表达式输入框
- 添加 cron 表达式验证
- 在任务列表表格中显示定时同步状态
- 修复任务详情导航路径

### 5. UI 样式统一
- 重构 DownloadPage.tsx 与 UsersPage.tsx 保持一致的样式风格
- 使用抖音配色方案: #FE2C55 (红), #312E2A (深色), #7A7570 (灰色), #EAE6E1 (边框)
- 统一表头样式 (h-16, border-b, bg-white)
- 统一卡片样式 (bg-white rounded-xl border border-[#EAE6E1])
- 自定义表格布局替代 shadcn Table
- 自定义弹窗样式，分离 header 和 footer
- 修复弹窗重复关闭按钮问题 (添加 showCloseButton={false})

### 6. 任务详情页样式统一 (TaskDetailPage.tsx)
- 重构 header 使用统一的 h-16 结构
- 使用自定义卡片替代 shadcn Card 组件
- 使用自定义表格布局替代 shadcn Table
- 使用统一的抖音配色方案
- 移除 Progress 组件，使用自定义进度条
- 统一状态标签样式

### 7. 首页作者筛选下拉框 (HomePage.tsx)
- 实现作者筛选下拉框功能
- 添加作者搜索功能
- 使用 ref 实现点击外部关闭下拉框

### 8. Bug 修复
- 修复 SQLite 字符串字面量语法错误 (双引号改为单引号)
- 修复首页作者搜索框中文输入实时过滤问题 (改用非受控输入 + onInput)
- 修复系统设置中下载路径设置不生效的问题 (syncer.ts 读取 download_path 设置)

## 修改的文件
- `src/main/database/index.ts`
- `src/main/services/scheduler.ts`
- `src/main/services/syncer.ts`
- `src/main/index.ts`
- `src/preload/index.ts`
- `src/preload/index.d.ts`
- `src/renderer/src/pages/settings/DownloadPage.tsx`
- `src/renderer/src/pages/settings/TaskDetailPage.tsx`
- `src/renderer/src/pages/HomePage.tsx`

## 执行结果
- [x] 数据库迁移成功
- [x] TypeScript 类型检查通过
- [x] 项目构建成功
